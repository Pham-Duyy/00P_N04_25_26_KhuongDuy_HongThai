<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Giao d·ªãch c·ªßa t√¥i</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .card {
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        .card-header {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border-radius: 16px 16px 0 0 !important;
        }
        .income-card {
            border-left: 4px solid #28a745;
        }
        .expense-card {
            border-left: 4px solid #dc3545;
        }
        .qr-payment-info {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 12px;
            padding: 20px;
        }
    </style>
</head>
<body>
<div class="container mt-4">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="fw-bold text-white mb-0">
                <i class="fas fa-exchange-alt me-2"></i>Giao d·ªãch c·ªßa t√¥i
            </h2>
            <p class="text-white-50 mb-0">Qu·∫£n l√Ω c√°c y√™u c·∫ßu ƒë√≥ng ti·ªÅn v√† th√¥ng b√°o chi</p>
        </div>
        <div>
            <a href="/user/dashboard" class="btn btn-outline-light">
                <i class="fas fa-arrow-left"></i> Quay l·∫°i
            </a>
        </div>
    </div>

    <!-- Th√¥ng b√°o -->
    <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert" id="successAlert">
        <i class="fas fa-check-circle me-2"></i>
        <span th:text="${success}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <!-- Giao d·ªãch thu c·∫ßn ƒë√≥ng -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">
                <i class="fas fa-arrow-up me-2"></i>Y√™u c·∫ßu ƒë√≥ng ti·ªÅn
                <span class="badge bg-light text-dark ms-2" th:text="${incomeTransactions != null ? incomeTransactions.size() : 0}"></span>
            </h5>
        </div>
        <div class="card-body">
            <div th:if="${incomeTransactions == null or #lists.isEmpty(incomeTransactions)}" class="text-center text-muted py-4">
                <i class="fas fa-money-bill-wave fa-3x mb-3 text-muted"></i>
                <p class="mb-0">Kh√¥ng c√≥ y√™u c·∫ßu ƒë√≥ng ti·ªÅn n√†o</p>
            </div>

            <div th:if="${incomeTransactions != null and !#lists.isEmpty(incomeTransactions)}">
                <div th:each="transaction : ${incomeTransactions}" class="row mb-4 income-card border rounded p-3">
                    <div class="col-md-8">
                        <h6 class="fw-bold text-success">
                            <i class="fas fa-arrow-up me-2"></i>
                            <span th:text="${transaction.title}"></span>
                        </h6>
                        <div class="mb-2">
                            <strong>Nh√≥m:</strong> <span class="badge bg-primary" th:text="${transaction.group.name}"></span>
                        </div>
                        <div class="mb-2">
                            <strong>S·ªë ti·ªÅn:</strong>
                            <span class="text-success fw-bold">
                                <span th:text="${#numbers.formatDecimal(transaction.amount, 0, 'COMMA', 0, 'POINT')}"></span> VNƒê
                            </span>
                        </div>
                        <div class="mb-2" th:if="${transaction.description}">
                            <strong>M√¥ t·∫£:</strong> <span th:text="${transaction.description}"></span>
                        </div>
                        <div class="mb-3">
                            <small class="text-muted">
                                <i class="fas fa-clock me-1"></i>
                                Ng√†y t·∫°o: <span th:text="${#temporals.format(transaction.createdDate, 'dd/MM/yyyy HH:mm')}"></span>
                            </small>
                        </div>
                        <button type="button" class="btn btn-success"
                                data-bs-toggle="modal"
                                th:attr="data-bs-target='#paymentModal' + ${transaction.id}">
                            <i class="fas fa-credit-card me-2"></i>Xem th√¥ng tin chuy·ªÉn kho·∫£n
                        </button>
                    </div>
                    <div class="col-md-4 text-center">
                        <div class="qr-payment-info">
                            <h6 class="fw-bold mb-3">üí≥ TH√îNG TIN CHUY·ªÇN KHO·∫¢N</h6>
                            <img src="/img/anh QR.jpg" alt="QR Techcombank"
                                 style="width:120px;height:120px;border-radius:8px;border:1px solid #eee;"
                                 class="mb-2">
                            <div class="text-start small">
                                <div class="mb-1"><strong>üèõÔ∏è Ng√¢n h√†ng:</strong> Techcombank</div>
                                <div class="mb-1"><strong>üìß STK:</strong> 9966504911</div>
                                <div class="mb-1"><strong>üë§ Ch·ªß TK:</strong> PHAM KHUONG DUY</div>
                            </div>
                        </div>
                    </div>
                    <!-- Modal chi ti·∫øt thanh to√°n ƒë·∫∑t ngay sau t·ª´ng transaction ƒë·ªÉ tr√°nh l·∫∑p nhi·ªÅu l·∫ßn -->
                    <div class="modal fade"
                         th:id="'paymentModal' + ${transaction.id}"
                         tabindex="-1">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">
                                        <i class="fas fa-credit-card me-2"></i>Th√¥ng tin chuy·ªÉn kho·∫£n
                                    </h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                </div>
                                <div class="modal-body">
                                    <div class="row">
                                        <div class="col-md-6 text-center">
                                            <h6 class="fw-bold mb-3">M√£ QR thanh to√°n</h6>
                                            <img src="/img/anh QR.jpg" alt="QR Techcombank"
                                                 style="width:250px;height:250px;border-radius:8px;border:1px solid #eee;"
                                                 class="mb-3">
                                            <p class="text-muted small">Qu√©t m√£ QR ƒë·ªÉ chuy·ªÉn kho·∫£n nhanh</p>
                                        </div>
                                        <div class="col-md-6">
                                            <h6 class="fw-bold mb-3">Th√¥ng tin chuy·ªÉn kho·∫£n</h6>
                                            <div class="card">
                                                <div class="card-body">
                                                    <div class="mb-3">
                                                        <strong>üèõÔ∏è Ng√¢n h√†ng:</strong><br>
                                                        <span class="text-primary">Techcombank</span>
                                                    </div>
                                                    <div class="mb-3">
                                                        <strong>üìß S·ªë t√†i kho·∫£n:</strong><br>
                                                        <span class="text-primary fw-bold">9966504911</span>
                                                        <button class="btn btn-sm btn-outline-primary ms-2" type="button" onclick="copyToClipboard('9966504911')">
                                                            <i class="fas fa-copy"></i>
                                                        </button>
                                                    </div>
                                                    <div class="mb-3">
                                                        <strong>üë§ Ch·ªß t√†i kho·∫£n:</strong><br>
                                                        <span class="text-primary">PHAM KHUONG DUY</span>
                                                    </div>
                                                    <div class="mb-3">
                                                        <strong>üí∞ S·ªë ti·ªÅn:</strong><br>
                                                        <span class="text-success fw-bold fs-5">
                                                            <span th:text="${#numbers.formatDecimal(transaction.amount, 0, 'COMMA', 0, 'POINT')}"></span> VNƒê
                                                        </span>
                                                    </div>
                                                    <div class="mb-3">
                                                        <strong>üìù N·ªôi dung chuy·ªÉn kho·∫£n:</strong><br>
                                                        <span class="text-info" th:text="${transaction.title}"></span>
                                                        <button class="btn btn-sm btn-outline-info ms-2" type="button"
                                                                th:attr="data-title=${transaction.title}"
                                                                onclick="copyToClipboard(this.getAttribute('data-title'))">
                                                            <i class="fas fa-copy"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ƒê√≥ng</button>
                                    <form th:action="@{/user/finance/transactions/{id}/confirm(id=${transaction.id})}" method="post" class="d-inline">
                                        <button type="submit" class="btn btn-success">
                                            <i class="fas fa-check me-2"></i>X√°c nh·∫≠n ƒë√£ chuy·ªÉn ti·ªÅn
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- End Modal -->
                </div>
            </div>
        </div>
    </div>

    <!-- Th√¥ng b√°o giao d·ªãch chi -->
    <div class="card">
        <div class="card-header">
            <h5 class="mb-0">
                <i class="fas fa-arrow-down me-2"></i>Th√¥ng b√°o chi ti√™u
                <span class="badge bg-light text-dark ms-2" th:text="${expenseNotifications != null ? expenseNotifications.size() : 0}"></span>
            </h5>
        </div>
        <div class="card-body">
            <div th:if="${expenseNotifications == null or #lists.isEmpty(expenseNotifications)}" class="text-center text-muted py-4">
                <i class="fas fa-bell-slash fa-3x mb-3 text-muted"></i>
                <p class="mb-0">Kh√¥ng c√≥ th√¥ng b√°o chi ti√™u n√†o</p>
            </div>

            <div th:if="${expenseNotifications != null and !#lists.isEmpty(expenseNotifications)}">
                <div th:each="transaction : ${expenseNotifications}" class="border rounded p-3 mb-3 expense-card">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h6 class="fw-bold text-danger">
                                <i class="fas fa-arrow-down me-2"></i>
                                <span th:text="${transaction.title}"></span>
                            </h6>
                            <div class="mb-2">
                                <strong>Nh√≥m:</strong> <span class="badge bg-primary" th:text="${transaction.group.name}"></span>
                            </div>
                            <div class="mb-2">
                                <strong>S·ªë ti·ªÅn:</strong>
                                <span class="text-danger fw-bold">
                                    <span th:text="${#numbers.formatDecimal(transaction.amount, 0, 'COMMA', 0, 'POINT')}"></span> VNƒê
                                </span>
                            </div>
                            <div class="mb-2" th:if="${transaction.description}">
                                <strong>M√¥ t·∫£:</strong> <span th:text="${transaction.description}"></span>
                            </div>
                            <small class="text-muted">
                                <i class="fas fa-clock me-1"></i>
                                <span th:text="${#temporals.format(transaction.createdDate, 'dd/MM/yyyy HH:mm')}"></span>
                            </small>
                        </div>
                        <div>
                            <span class="badge bg-info">
                                <i class="fas fa-bell"></i> Th√¥ng b√°o
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    function copyToClipboard(text) {
        navigator.clipboard.writeText(text).then(function() {
            alert('ƒê√£ sao ch√©p: ' + text);
        }, function(err) {
            console.error('Kh√¥ng th·ªÉ sao ch√©p: ', err);
        });
    }

    // ·∫®n th√¥ng b√°o th√†nh c√¥ng sau 2.5 gi√¢y
    document.addEventListener('DOMContentLoaded', function() {
        var alertBox = document.getElementById('successAlert');
        if (alertBox) {
            setTimeout(function() {
                var alert = bootstrap.Alert.getOrCreateInstance(alertBox);
                alert.close();
            }, 2500);
        }
    });
</script>
</body>
</html>