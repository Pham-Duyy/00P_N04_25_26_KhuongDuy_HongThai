<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Qu·∫£n l√Ω thu chi</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #0f172a;
      font-family: "Poppins", sans-serif;
      color: #e2e8f0;
      padding: 24px;
    }
    .glass {
      background: rgba(30, 41, 59, 0.4);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      padding: 32px;
    }
    .tab-active {
      border-bottom: 2px solid #22c55e;
      color: #22c55e;
      cursor: pointer;
      padding: 8px 16px;
      transition: all 0.3s ease;
    }
    .tab-inactive {
      border-bottom: 2px solid transparent;
      color: #94a3b8;
      cursor: pointer;
      padding: 8px 16px;
      transition: all 0.3s ease;
    }
    .tab-inactive:hover {
      color: #cbd5e1;
    }
    .no-data {
      display: none;
    }
  </style>
</head>
<body>
  <div class="max-w-7xl mx-auto glass">
    <h1 class="text-3xl font-bold text-center mb-6 text-white">
      üí≥ Qu·∫£n l√Ω thu chi
    </h1>

    <!-- ‚úÖ Debug info - ch·ªâ hi·ªán khi dev -->
    <div th:if="${#ctx.getVariable('debug') != null}" class="mb-4 p-3 bg-gray-600/20 border border-gray-500/30 rounded-lg text-xs">
      <p class="text-gray-300">üîç DEBUG: 
        <span th:text="${transactions != null ? transactions.size() : 'NULL'}">0</span> transactions loaded
      </p>
      <p class="text-gray-300" th:if="${transactions != null}">
        Thu: <span th:text="${transactions.?[type != null and type.name() == 'INCOME'].size()}">0</span> | 
        Chi: <span th:text="${transactions.?[type != null and type.name() == 'EXPENSE'].size()}">0</span>
      </p>
    </div>

    <!-- Hi·ªÉn th·ªã th√¥ng b√°o th√†nh c√¥ng -->
    <div th:if="${successMessage}" class="mb-6 p-4 bg-green-600/20 border border-green-600/30 rounded-lg">
      <div class="flex items-center">
        <i class="fas fa-check-circle text-green-400 mr-3"></i>
        <p class="text-green-400 font-semibold" th:text="${successMessage}"></p>
      </div>
      <p th:if="${newTransactionId}" class="text-slate-300 text-sm mt-2 ml-6">
        <i class="fas fa-info-circle mr-1"></i>
        ID giao d·ªãch m·ªõi: <span class="font-mono text-blue-400" th:text="${newTransactionId}"></span>
      </p>
    </div>

    <!-- Hi·ªÉn th·ªã th√¥ng b√°o l·ªói -->
    <div th:if="${error}" class="mb-6 p-4 bg-red-600/20 border border-red-600/30 rounded-lg">
      <div class="flex items-center">
        <i class="fas fa-exclamation-triangle text-red-400 mr-3"></i>
        <p class="text-red-400 font-semibold" th:text="${error}"></p>
      </div>
    </div>

    <!-- B·ªô l·ªçc nh√≥m v√† tr·∫°ng th√°i -->
    <div class="mb-6 flex flex-wrap justify-between items-center gap-4">
      <div class="flex flex-wrap items-center gap-4">
        <!-- L·ªçc theo nh√≥m -->
        <form method="get" class="flex items-center space-x-2">
          <input type="hidden" name="status" th:value="${selectedStatus}">
          <label class="text-white text-sm font-medium">
            <i class="fas fa-filter mr-1"></i>Nh√≥m:
          </label>
          <select name="groupId" onchange="this.form.submit()" 
                  class="bg-slate-700 text-white px-3 py-2 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none min-w-[150px]">
            <option value="">T·∫•t c·∫£ nh√≥m</option>
            <option th:each="group : ${groups}" 
                    th:value="${group.id}" 
                    th:text="${group.name}"
                    th:selected="${selectedGroupId != null && selectedGroupId == group.id}">
            </option>
          </select>
        </form>
        
        <!-- L·ªçc theo tr·∫°ng th√°i -->
        <form method="get" class="flex items-center space-x-2">
          <input type="hidden" name="groupId" th:value="${selectedGroupId}">
          <label class="text-white text-sm font-medium">
            <i class="fas fa-flag mr-1"></i>Tr·∫°ng th√°i:
          </label>
          <select name="status" onchange="this.form.submit()" 
                  class="bg-slate-700 text-white px-3 py-2 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none min-w-[130px]">
            <option value="">T·∫•t c·∫£</option>
            <option value="COMPLETED" th:selected="${selectedStatus == 'COMPLETED'}">‚úÖ Ho√†n th√†nh</option>
            <option value="PENDING" th:selected="${selectedStatus == 'PENDING'}">‚è≥ ƒêang ch·ªù</option>
            <option value="CANCELLED" th:selected="${selectedStatus == 'CANCELLED'}">‚ùå ƒê√£ h·ªßy</option>
            <option value="FAILED" th:selected="${selectedStatus == 'FAILED'}">üí• Th·∫•t b·∫°i</option>
          </select>
        </form>
      </div>

      <!-- N√∫t refresh -->
      <a th:href="@{/admin/finance}" 
         class="bg-gray-600 hover:bg-gray-700 text-white px-3 py-2 rounded-lg shadow transition text-sm">
        <i class="fas fa-sync-alt mr-1"></i> L√†m m·ªõi
      </a>
    </div>

    <!-- Tabs -->
    <div class="flex justify-center space-x-2 mb-6 bg-slate-800/50 rounded-lg p-2 w-fit mx-auto">
      <button onclick="showTab('thu')" id="tab-thu" 
              class="tab-active rounded-lg">
        <i class="fas fa-arrow-up mr-2"></i>Thu
      </button>
      <button onclick="showTab('chi')" id="tab-chi" 
              class="tab-inactive rounded-lg">
        <i class="fas fa-arrow-down mr-2"></i>Chi
      </button>
      <button onclick="showTab('all')" id="tab-all" 
              class="tab-inactive rounded-lg">
        <i class="fas fa-list mr-2"></i>T·∫•t c·∫£
      </button>
    </div>

    <!-- N√∫t t·∫°o giao d·ªãch -->
    <div class="text-center mb-6">
      <a th:href="@{/admin/finance/income/new(groupId=${selectedGroupId})}" 
         class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg shadow mr-3 transition inline-flex items-center">
        <i class="fas fa-plus mr-2"></i> T·∫°o giao d·ªãch thu
      </a>
      <a th:href="@{/admin/finance/expense/new(groupId=${selectedGroupId})}" 
         class="bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg shadow transition inline-flex items-center">
        <i class="fas fa-plus mr-2"></i> T·∫°o giao d·ªãch chi
      </a>
    </div>

    <!-- Hi·ªÉn th·ªã nh√≥m ƒë√£ ch·ªçn -->
    <div th:if="${selectedGroup}" class="mb-6 p-4 bg-slate-700/50 rounded-lg border border-slate-600">
      <div class="flex items-center justify-between">
        <div class="flex items-center">
          <i class="fas fa-users text-blue-400 mr-3"></i>
          <span class="text-white font-semibold">ƒêang xem nh√≥m: 
            <span class="text-blue-400" th:text="${selectedGroup.name}"></span>
          </span>
          <span class="text-slate-400 ml-4" th:if="${selectedGroup.users}">
            (<span th:text="${selectedGroup.users.size()}"></span> th√†nh vi√™n)
          </span>
        </div>
        <a th:href="@{/admin/finance}" class="text-slate-400 hover:text-white transition text-sm">
          <i class="fas fa-times"></i> B·ªè l·ªçc
        </a>
      </div>
    </div>

    <!-- ‚úÖ Tab Thu -->
    <div id="thu-content">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-xl font-bold text-green-400">
          <i class="fas fa-coins mr-2"></i>Giao d·ªãch Thu
        </h3>
        <span class="text-slate-400 text-sm">
          <span th:text="${transactions != null ? transactions.?[type != null and type.name() == 'INCOME'].size() : 0}">0</span> giao d·ªãch
        </span>
      </div>
      
      <div class="overflow-x-auto bg-slate-800/30 rounded-lg">
        <table class="w-full text-sm text-left text-white">
          <thead class="bg-slate-700 text-slate-200 uppercase text-xs">
            <tr>
              <th class="px-4 py-4">ID</th>
              <th class="px-4 py-4">S·ªë ti·ªÅn</th>
              <th class="px-4 py-4">M√¥ t·∫£</th>
              <th class="px-4 py-4">Nh√≥m</th>
              <th class="px-4 py-4">Ng∆∞·ªùi t·∫°o</th>
              <th class="px-4 py-4">Ng√†y t·∫°o</th>
              <th class="px-4 py-4">Tr·∫°ng th√°i</th>
              <th class="px-4 py-4 text-center">Thao t√°c</th>
            </tr>
          </thead>
          <tbody>
            <!-- ‚úÖ S·ª≠a l·∫°i ƒëi·ªÅu ki·ªán hi·ªÉn th·ªã -->
            <tr th:each="tx : ${transactions}" 
                th:if="${tx.type != null and tx.type.name() == 'INCOME'}" 
                class="border-b border-slate-700 hover:bg-slate-700/50 transition">
              <td class="px-4 py-4 font-mono text-blue-400" th:text="${tx.id}"></td>
              <td class="px-4 py-4">
                <span class="text-green-400 font-bold text-lg" 
                      th:text="'+' + ${#numbers.formatDecimal(tx.amount, 0, 'COMMA', 0, 'POINT')} + '‚Ç´'"></span>
              </td>
              <td class="px-4 py-4">
                <p class="text-white" th:text="${tx.description}"></p>
              </td>
              <td class="px-4 py-4">
                <span class="bg-blue-600 px-3 py-1 rounded-full text-xs font-medium" 
                      th:text="${tx.group != null ? tx.group.name : 'N/A'}"></span>
              </td>
              <td class="px-4 py-4 text-slate-300" 
                  th:text="${tx.createdBy != null ? (tx.createdBy.name != null ? tx.createdBy.name : tx.createdBy.email) : 'N/A'}"></td>
              <td class="px-4 py-4 text-slate-400" 
                  th:text="${tx.date != null ? #temporals.format(tx.date, 'dd/MM/yyyy HH:mm') : 'N/A'}"></td>
              <td class="px-4 py-4">
                <span th:if="${tx.status == 'COMPLETED'}" 
                      class="bg-green-600 px-3 py-1 rounded-full text-xs font-medium">‚úÖ Ho√†n th√†nh</span>
                <span th:if="${tx.status == 'PENDING'}" 
                      class="bg-yellow-600 px-3 py-1 rounded-full text-xs font-medium">‚è≥ Ch·ªù x·ª≠ l√Ω</span>
                <span th:if="${tx.status == 'CANCELLED'}" 
                      class="bg-red-600 px-3 py-1 rounded-full text-xs font-medium">‚ùå ƒê√£ h·ªßy</span>
                <span th:if="${tx.status == 'FAILED'}" 
                      class="bg-gray-600 px-3 py-1 rounded-full text-xs font-medium">üí• Th·∫•t b·∫°i</span>
              </td>
              <td class="px-4 py-4">
                <div class="flex justify-center space-x-2">
                  <a th:href="@{'/admin/finance/detail/' + ${tx.id}}" 
                     class="text-blue-400 hover:text-blue-300 p-2 rounded-lg bg-blue-600/20 hover:bg-blue-600/30 transition" 
                     title="Xem chi ti·∫øt">
                    <i class="fas fa-eye"></i>
                  </a>
                  <a th:href="@{'/admin/finance/edit/' + ${tx.id}}" 
                     class="text-yellow-400 hover:text-yellow-300 p-2 rounded-lg bg-yellow-600/20 hover:bg-yellow-600/30 transition" 
                     title="Ch·ªânh s·ª≠a">
                    <i class="fas fa-edit"></i>
                  </a>
                  <form th:action="@{'/admin/finance/delete/' + ${tx.id}}" 
                        method="post" style="display:inline;"
                        onsubmit="return confirm('‚ö†Ô∏è B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a giao d·ªãch n√†y?\n\nVi·ªác x√≥a s·∫Ω kh√¥ng th·ªÉ ho√†n t√°c!')">
                    <input type="hidden" name="groupId" th:value="${selectedGroupId}">
                    <button type="submit" 
                            class="text-red-400 hover:text-red-300 p-2 rounded-lg bg-red-600/20 hover:bg-red-600/30 transition" 
                            title="X√≥a giao d·ªãch">
                      <i class="fas fa-trash"></i>
                    </button>
                  </form>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
        
        <!-- ‚úÖ Empty state cho Thu v·ªõi ƒëi·ªÅu ki·ªán ch√≠nh x√°c -->
        <div class="text-center py-12 text-slate-400" id="thu-empty-state">
          <i class="fas fa-inbox text-6xl mb-4 opacity-50"></i>
          <h3 class="text-lg font-semibold mb-2">Ch∆∞a c√≥ giao d·ªãch thu n√†o</h3>
          <p class="text-sm mb-4">H√£y t·∫°o giao d·ªãch thu ƒë·∫ßu ti√™n cho nh√≥m</p>
          <a th:href="@{/admin/finance/income/new(groupId=${selectedGroupId})}" 
             class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg shadow transition inline-flex items-center">
            <i class="fas fa-plus mr-2"></i> T·∫°o giao d·ªãch thu
          </a>
        </div>
      </div>
    </div>

    <!-- ‚úÖ Tab Chi -->
    <div id="chi-content" class="hidden">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-xl font-bold text-red-400">
          <i class="fas fa-credit-card mr-2"></i>Giao d·ªãch Chi
        </h3>
        <span class="text-slate-400 text-sm">
          <span th:text="${transactions != null ? transactions.?[type != null and type.name() == 'EXPENSE'].size() : 0}">0</span> giao d·ªãch
        </span>
      </div>
      
      <div class="overflow-x-auto bg-slate-800/30 rounded-lg">
        <table class="w-full text-sm text-left text-white">
          <thead class="bg-slate-700 text-slate-200 uppercase text-xs">
            <tr>
              <th class="px-4 py-4">ID</th>
              <th class="px-4 py-4">S·ªë ti·ªÅn</th>
              <th class="px-4 py-4">M√¥ t·∫£</th>
              <th class="px-4 py-4">Nh√≥m</th>
              <th class="px-4 py-4">Ng∆∞·ªùi t·∫°o</th>
              <th class="px-4 py-4">Ng√†y t·∫°o</th>
              <th class="px-4 py-4">Tr·∫°ng th√°i</th>
              <th class="px-4 py-4 text-center">Thao t√°c</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="tx : ${transactions}" 
                th:if="${tx.type != null and tx.type.name() == 'EXPENSE'}" 
                class="border-b border-slate-700 hover:bg-slate-700/50 transition">
              <td class="px-4 py-4 font-mono text-blue-400" th:text="${tx.id}"></td>
              <td class="px-4 py-4">
                <span class="text-red-400 font-bold text-lg" 
                      th:text="'-' + ${#numbers.formatDecimal(tx.amount, 0, 'COMMA', 0, 'POINT')} + '‚Ç´'"></span>
              </td>
              <td class="px-4 py-4">
                <p class="text-white" th:text="${tx.description}"></p>
              </td>
              <td class="px-4 py-4">
                <span class="bg-purple-600 px-3 py-1 rounded-full text-xs font-medium" 
                      th:text="${tx.group != null ? tx.group.name : 'N/A'}"></span>
              </td>
              <td class="px-4 py-4 text-slate-300" 
                  th:text="${tx.createdBy != null ? (tx.createdBy.name != null ? tx.createdBy.name : tx.createdBy.email) : 'N/A'}"></td>
              <td class="px-4 py-4 text-slate-400" 
                  th:text="${tx.date != null ? #temporals.format(tx.date, 'dd/MM/yyyy HH:mm') : 'N/A'}"></td>
              <td class="px-4 py-4">
                <span th:if="${tx.status == 'COMPLETED'}" 
                      class="bg-green-600 px-3 py-1 rounded-full text-xs font-medium">‚úÖ Ho√†n th√†nh</span>
                <span th:if="${tx.status == 'PENDING'}" 
                      class="bg-yellow-600 px-3 py-1 rounded-full text-xs font-medium">‚è≥ Ch·ªù x·ª≠ l√Ω</span>
                <span th:if="${tx.status == 'CANCELLED'}" 
                      class="bg-red-600 px-3 py-1 rounded-full text-xs font-medium">‚ùå ƒê√£ h·ªßy</span>
                <span th:if="${tx.status == 'FAILED'}" 
                      class="bg-gray-600 px-3 py-1 rounded-full text-xs font-medium">üí• Th·∫•t b·∫°i</span>
              </td>
              <td class="px-4 py-4">
                <div class="flex justify-center space-x-2">
                  <a th:href="@{'/admin/finance/detail/' + ${tx.id}}" 
                     class="text-blue-400 hover:text-blue-300 p-2 rounded-lg bg-blue-600/20 hover:bg-blue-600/30 transition" 
                     title="Xem chi ti·∫øt">
                    <i class="fas fa-eye"></i>
                  </a>
                  <a th:href="@{'/admin/finance/edit/' + ${tx.id}}" 
                     class="text-yellow-400 hover:text-yellow-300 p-2 rounded-lg bg-yellow-600/20 hover:bg-yellow-600/30 transition" 
                     title="Ch·ªânh s·ª≠a">
                    <i class="fas fa-edit"></i>
                  </a>
                  <form th:action="@{'/admin/finance/delete/' + ${tx.id}}" 
                        method="post" style="display:inline;"
                        onsubmit="return confirm('‚ö†Ô∏è B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a giao d·ªãch n√†y?\n\nVi·ªác x√≥a s·∫Ω kh√¥ng th·ªÉ ho√†n t√°c!')">
                    <input type="hidden" name="groupId" th:value="${selectedGroupId}">
                    <button type="submit" 
                            class="text-red-400 hover:text-red-300 p-2 rounded-lg bg-red-600/20 hover:bg-red-600/30 transition" 
                            title="X√≥a giao d·ªãch">
                      <i class="fas fa-trash"></i>
                    </button>
                  </form>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
        
        <!-- Empty state cho Chi -->
        <div class="text-center py-12 text-slate-400" id="chi-empty-state">
          <i class="fas fa-inbox text-6xl mb-4 opacity-50"></i>
          <h3 class="text-lg font-semibold mb-2">Ch∆∞a c√≥ giao d·ªãch chi n√†o</h3>
          <p class="text-sm mb-4">H√£y t·∫°o giao d·ªãch chi ƒë·∫ßu ti√™n cho nh√≥m</p>
          <a th:href="@{/admin/finance/expense/new(groupId=${selectedGroupId})}" 
             class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg shadow transition inline-flex items-center">
            <i class="fas fa-plus mr-2"></i> T·∫°o giao d·ªãch chi
          </a>
        </div>
      </div>
    </div>

    <!-- ‚úÖ Tab T·∫•t c·∫£ -->
    <div id="all-content" class="hidden">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-xl font-bold text-white">
          <i class="fas fa-list mr-2"></i>T·∫•t c·∫£ giao d·ªãch
        </h3>
        <span class="text-slate-400 text-sm">
          <span th:text="${transactions != null ? transactions.size() : 0}">0</span> giao d·ªãch
        </span>
      </div>
      
      <div class="overflow-x-auto bg-slate-800/30 rounded-lg">
        <table class="w-full text-sm text-left text-white">
          <thead class="bg-slate-700 text-slate-200 uppercase text-xs">
            <tr>
              <th class="px-4 py-4">ID</th>
              <th class="px-4 py-4">Lo·∫°i</th>
              <th class="px-4 py-4">S·ªë ti·ªÅn</th>
              <th class="px-4 py-4">M√¥ t·∫£</th>
              <th class="px-4 py-4">Nh√≥m</th>
              <th class="px-4 py-4">Ng∆∞·ªùi t·∫°o</th>
              <th class="px-4 py-4">Ng√†y t·∫°o</th>
              <th class="px-4 py-4">Tr·∫°ng th√°i</th>
              <th class="px-4 py-4 text-center">Thao t√°c</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="tx : ${transactions}" class="border-b border-slate-700 hover:bg-slate-700/50 transition">
              <td class="px-4 py-4 font-mono text-blue-400" th:text="${tx.id}"></td>
              <td class="px-4 py-4">
                <span th:if="${tx.type != null and tx.type.name() == 'INCOME'}" 
                      class="bg-green-600 px-2 py-1 rounded-full text-xs font-medium">üìà Thu</span>
                <span th:if="${tx.type != null and tx.type.name() == 'EXPENSE'}" 
                      class="bg-red-600 px-2 py-1 rounded-full text-xs font-medium">üìâ Chi</span>
              </td>
              <td class="px-4 py-4">
                <span th:if="${tx.type != null and tx.type.name() == 'INCOME'}" 
                      class="text-green-400 font-bold text-lg" 
                      th:text="'+' + ${#numbers.formatDecimal(tx.amount, 0, 'COMMA', 0, 'POINT')} + '‚Ç´'"></span>
                <span th:if="${tx.type != null and tx.type.name() == 'EXPENSE'}" 
                      class="text-red-400 font-bold text-lg" 
                      th:text="'-' + ${#numbers.formatDecimal(tx.amount, 0, 'COMMA', 0, 'POINT')} + '‚Ç´'"></span>
              </td>
              <td class="px-4 py-4">
                <p class="text-white" th:text="${tx.description}"></p>
              </td>
              <td class="px-4 py-4">
                <span class="bg-indigo-600 px-3 py-1 rounded-full text-xs font-medium" 
                      th:text="${tx.group != null ? tx.group.name : 'N/A'}"></span>
              </td>
              <td class="px-4 py-4 text-slate-300" 
                  th:text="${tx.createdBy != null ? (tx.createdBy.name != null ? tx.createdBy.name : tx.createdBy.email) : 'N/A'}"></td>
              <td class="px-4 py-4 text-slate-400" 
                  th:text="${tx.date != null ? #temporals.format(tx.date, 'dd/MM/yyyy HH:mm') : 'N/A'}"></td>
              <td class="px-4 py-4">
                <span th:if="${tx.status == 'COMPLETED'}" 
                      class="bg-green-600 px-3 py-1 rounded-full text-xs font-medium">‚úÖ Ho√†n th√†nh</span>
                <span th:if="${tx.status == 'PENDING'}" 
                      class="bg-yellow-600 px-3 py-1 rounded-full text-xs font-medium">‚è≥ Ch·ªù x·ª≠ l√Ω</span>
                <span th:if="${tx.status == 'CANCELLED'}" 
                      class="bg-red-600 px-3 py-1 rounded-full text-xs font-medium">‚ùå ƒê√£ h·ªßy</span>
                <span th:if="${tx.status == 'FAILED'}" 
                      class="bg-gray-600 px-3 py-1 rounded-full text-xs font-medium">üí• Th·∫•t b·∫°i</span>
              </td>
              <td class="px-4 py-4">
                <div class="flex justify-center space-x-2">
                  <a th:href="@{'/admin/finance/detail/' + ${tx.id}}" 
                     class="text-blue-400 hover:text-blue-300 p-2 rounded-lg bg-blue-600/20 hover:bg-blue-600/30 transition" 
                     title="Xem chi ti·∫øt">
                    <i class="fas fa-eye"></i>
                  </a>
                  <a th:href="@{'/admin/finance/edit/' + ${tx.id}}" 
                     class="text-yellow-400 hover:text-yellow-300 p-2 rounded-lg bg-yellow-600/20 hover:bg-yellow-600/30 transition" 
                     title="Ch·ªânh s·ª≠a">
                    <i class="fas fa-edit"></i>
                  </a>
                  <form th:action="@{'/admin/finance/delete/' + ${tx.id}}" 
                        method="post" style="display:inline;"
                        onsubmit="return confirm('‚ö†Ô∏è B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a giao d·ªãch n√†y?\n\nVi·ªác x√≥a s·∫Ω kh√¥ng th·ªÉ ho√†n t√°c!')">
                    <input type="hidden" name="groupId" th:value="${selectedGroupId}">
                    <button type="submit" 
                            class="text-red-400 hover:text-red-300 p-2 rounded-lg bg-red-600/20 hover:bg-red-600/30 transition" 
                            title="X√≥a giao d·ªãch">
                      <i class="fas fa-trash"></i>
                    </button>
                  </form>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
        
        <!-- Empty state cho T·∫•t c·∫£ -->
        <div class="text-center py-12 text-slate-400" id="all-empty-state">
          <i class="fas fa-inbox text-6xl mb-4 opacity-50"></i>
          <h3 class="text-lg font-semibold mb-2">Ch∆∞a c√≥ giao d·ªãch n√†o</h3>
          <p class="text-sm mb-4">H√£y t·∫°o giao d·ªãch ƒë·∫ßu ti√™n cho nh√≥m</p>
          <div class="space-x-2">
            <a th:href="@{/admin/finance/income/new(groupId=${selectedGroupId})}" 
               class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg shadow transition inline-flex items-center">
              <i class="fas fa-plus mr-2"></i> Thu
            </a>
            <a th:href="@{/admin/finance/expense/new(groupId=${selectedGroupId})}" 
               class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg shadow transition inline-flex items-center">
              <i class="fas fa-plus mr-2"></i> Chi
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Th·ªëng k√™ t·ªïng quan -->
    <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-6">
      <div class="bg-green-600/20 p-6 rounded-xl border border-green-600/30 backdrop-blur-sm">
        <div class="flex items-center justify-between">
          <div>
            <h4 class="text-green-400 font-bold text-lg">üí∞ T·ªïng Thu</h4>
            <p class="text-3xl font-bold text-white mt-2" 
               th:text="${#numbers.formatDecimal(totalIncome != null ? totalIncome : 0, 0, 'COMMA', 0, 'POINT')} + '‚Ç´'">0‚Ç´</p>
          </div>
          <i class="fas fa-arrow-up text-green-400 text-2xl opacity-50"></i>
        </div>
      </div>
      
      <div class="bg-red-600/20 p-6 rounded-xl border border-red-600/30 backdrop-blur-sm">
        <div class="flex items-center justify-between">
          <div>
            <h4 class="text-red-400 font-bold text-lg">üí∏ T·ªïng Chi</h4>
            <p class="text-3xl font-bold text-white mt-2" 
               th:text="${#numbers.formatDecimal(totalExpense != null ? totalExpense : 0, 0, 'COMMA', 0, 'POINT')} + '‚Ç´'">0‚Ç´</p>
          </div>
          <i class="fas fa-arrow-down text-red-400 text-2xl opacity-50"></i>
        </div>
      </div>
      
      <div class="bg-blue-600/20 p-6 rounded-xl border border-blue-600/30 backdrop-blur-sm">
        <div class="flex items-center justify-between">
          <div>
            <h4 class="text-blue-400 font-bold text-lg">üìä S·ªë d∆∞</h4>
            <p class="text-3xl font-bold mt-2" 
               th:classappend="${(balance != null ? balance : 0) >= 0 ? 'text-green-400' : 'text-red-400'}"
               th:text="${#numbers.formatDecimal(balance != null ? balance : 0, 0, 'COMMA', 0, 'POINT')} + '‚Ç´'">0‚Ç´</p>
          </div>
          <i class="fas fa-balance-scale text-blue-400 text-2xl opacity-50"></i>
        </div>
      </div>
    </div>
  </div>

  <script>
    function showTab(tab) {
      // Hide all content
      document.getElementById('thu-content').classList.add('hidden');
      document.getElementById('chi-content').classList.add('hidden');
      document.getElementById('all-content').classList.add('hidden');
      
      // Reset all tabs
      document.getElementById('tab-thu').className = 'tab-inactive rounded-lg';
      document.getElementById('tab-chi').className = 'tab-inactive rounded-lg';
      document.getElementById('tab-all').className = 'tab-inactive rounded-lg';

      // Show selected content and activate tab
      if (tab === 'thu') {
        document.getElementById('thu-content').classList.remove('hidden');
        document.getElementById('tab-thu').className = 'tab-active rounded-lg';
        checkEmptyState('thu');
      } else if (tab === 'chi') {
        document.getElementById('chi-content').classList.remove('hidden');
        document.getElementById('tab-chi').className = 'tab-active rounded-lg';
        checkEmptyState('chi');
      } else if (tab === 'all') {
        document.getElementById('all-content').classList.remove('hidden');
        document.getElementById('tab-all').className = 'tab-active rounded-lg';
        checkEmptyState('all');
      }
    }

    // ‚úÖ Check empty state v√† hi·ªán/·∫©n table vs empty message
    function checkEmptyState(tab) {
      let table, emptyState;
      
      if (tab === 'thu') {
        table = document.querySelector('#thu-content tbody');
        emptyState = document.getElementById('thu-empty-state');
      } else if (tab === 'chi') {
        table = document.querySelector('#chi-content tbody');
        emptyState = document.getElementById('chi-empty-state');
      } else if (tab === 'all') {
        table = document.querySelector('#all-content tbody');
        emptyState = document.getElementById('all-empty-state');
      }
      
      if (table && emptyState) {
        const hasRows = table.querySelectorAll('tr').length > 0;
        if (hasRows) {
          emptyState.style.display = 'none';
        } else {
          emptyState.style.display = 'block';
        }
      }
    }

    // Auto-hide success message after 5 seconds
    document.addEventListener('DOMContentLoaded', function() {
      // Check empty states on load
      checkEmptyState('thu');
      
      const successMessage = document.querySelector('.bg-green-600\\/20');
      if (successMessage) {
        setTimeout(() => {
          successMessage.style.transition = 'opacity 0.5s ease-out';
          successMessage.style.opacity = '0';
          setTimeout(() => successMessage.remove(), 500);
        }, 5000);
      }
    });
  </script>
</body>
</html>